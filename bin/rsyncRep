#!/bin/bash
#
# Brief description of your script
# Copyright 2022 bombi

function main() {

  # $1 = commit

  if [[ -n "$1" ]];
  then

    cd userRep || exit

    echo "Hinzufügen von push.autoSetupRemote true"
    git config --global --add --bool push.autoSetupRemote true

    echo "führe fetch aus:" &> ../firstFetch.txt
    git fetch

    echo "Erstellen von Branch main:" &> ../firstCheckout.txt
    git checkout -b main

    echo "Nochmal fetch ausführen - um den Unterschied zu sehen:"
    git fetch &> ../secondFetch.txt

    echo "Branch main auf den Rechner holen"
    git pull -f origin main &> ../pullMain.txt

    #echo "checkout now to mainHolder"
    #git checkout -b mainHolder

    echo "Eine Ebene runter... und Ordner anzeigen"
    cd ..

    ls -a userRep &> showFolderBeforeRemove.txt

    echo "Inhalt von Partarum löschen - einzig im Branch $1"
    rm -rf userRep/*

    ls -a userRep &> showFolderAfterRemove.txt

    echo "Zurück zu tmp wechseln und Git - Cache bereinigen:"
    cd userRep || exit
    git rm -rf .

    echo "Commit erstellen für ersten Push - hier wird erstmal gelöscht:"
    git commit -m "$1 - first round - delete"

    git status &> ../statusAfterCommit.txt

    echo "Ausführen des Pushs"
    git push -u

    echo "Wir verlassen temp wieder"
    cd ..

    mkdir backup
    mv userRep/.git backup/.git

    echo "rsync von partarum-modular zu temp"
    rsync -a -p --exclude-from=rsync_exclude Partarum/. userRep &> logRsync.txt

    echo "wir gehen wieder zu userRep"
    cd userRep || exit

    git add --all API/
    git add --all app/
    git add --all cli/
    git add --all config/
    git add --all Partarum/
    git add --all public/

    git add .gitignore
    git add .htaccess
    git add composer.json
    git add composer.lock
    git add index.php
    git add LICENSE
    git add README.md

    echo "Hinzufügen der Commits:"
    git commit -m "$1"

    git remote -v &> ../finishRemote.txt

    git status &> ../finishStatus.txt

    git branch &> ../finishBranch.txt

    echo "Ausführen des Pushs"
    git push -u &> ../finishPush.txt

    #echo "Zeige Ordner public/assets aus dem Script heraus:"
    #ls -R public/assets

    #echo "Hinzufügen von push.autoSetupRemote true"
    #git config --global --add --bool push.autoSetupRemote true

    #echo "Hinzufügen von push.default is current"
    #git config --global push.default current

    #echo "Folgende Branches sind gelistet:"
    #git branch -v

    #echo "zeige aktuelle Remoteverbindungen nach dem autosetup:"
    #git remote -v

    #echo "Zeige Status:"
    #git status

    #echo "Ausführen des Pushs"
    #git push -u

    #echo "Zeige Status:"
    #git status

  else
    echo "Du hast den Commit vergessen" &> noCommit.txt
  fi

    # add remot
    # pull and push
}

main "$@"